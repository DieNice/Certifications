---
tags:
  - Аттестация
date: 2024-06-03
author: Проскурин Д.А
---
# Вопросы

- Назовите общую структуру SQL запроса;
- select.  Кратко что такое;
- from. Что можно указать кроме таблицы как источник данных? (cte, subquery, temp table, view);
- join. Кратко что такое;
- where. Кратко что такое;
- group by. Назовите основные функции агрегации. Как правильно указывать список полей в секции select при группировке;
- having. Отличие от where. Можно ли отдельно использовать having без group by?

**В PostgreSQL можно использовать предложение HAVING без предложения GROUP BY**. В этом случае считается, что все выбранные строки образуют единую группу, а предложение SELECT и HAVING может ссылаться только на столбцы таблицы из агрегатных функций. 

Такой запрос выдаст одну строку, если условие HAVING истинно, и ноль строк, если оно не истинно. [2](https://tr-page.yandex.ru/translate?lang=en-ru&url=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F5496786%2Fhaving-clause-in-postgresql)
```sql
 SELECT 'T' AS result
   FROM Book
 HAVING MIN(NumberOfPages) < MAX(NumberOfPages);
```
- order by. Кратко что такое;
- distinct; Краткое что такое;
- limit, offset; Краткое что такое;
- Особенности работы order by с limit?
- Особенности работы в pgsql, clickhouse; 

## ⚠ Вопрос повышенной сложности. Этапы выполнения sql-запроса.

### Разбор SQL запроса
- **Лексический анализ**. Сначала лексический анализатор разбивает текст запроса на ключевые слова, строковые и числовые литералы и другие идентификаторы. Для каждого найденного ключевого слова или идентификатора будет сгенерирован символ языка, который затем передается синтаксическому анализатору.
- **Синтаксический анализ**. Синтаксический анализатор проверяет полученный набор лексем на соответствие грамматике языка, после чего он строит дерево из лексем запроса.
- **Семантический анализ**. Семантический анализатор обращается к системным каталогам и дополняет дерево запроса ссылками на конкретные объекты базы данных с указанием типов данных и другой информацией.
### Трансформация SQL запроса
Здесь происходит преобразование имен представлений в узлах дерева в новые поддеревья, которые соответствуют этим представлениям. Трансформация необходима для предоставления планировщику полной информации о таблицах и их связей между собой для построения оптимального плана выполнения запроса.
### Планирование запроса
Здесь происходит поиск наиболее оптимального способа выполнения запроса. Для этого планировщик осуществляет перебор возможных планов выполнения, оценивает затраты на исполнение и присваивает каждому определенную стоимость.

В первую очередь планировщик вырабатывает планы сканирования для таблиц с учетом наличия у них индексов. Далее происходит выработка планов соединения таблиц. В конечном итоге планировщик формирует дерево плана, состоящее из отдельных операций.
Основные операции, составляемые планировщиком:
- Seq Scan – последовательное сканирование;
- Index Scan – индексное сканирование;
- Bitmap Index Scan – сканирование с построением битовых карт;
- Merge Join – соединение слиянием;
- Nested Loop – соединение с вложенным циклом;
- Hash Join – соединение по хэшу;
- Sort – операция сортировки по столбцам;
- Aggregate – вычисление агрегатных функций;
- GroupAggregate – группировка отсортированного набора;
- Unique – удаление повторяющихся данных;
- Limit – прекращение операции, после выбора нужного количества строк.
### Исполнение запроса
Исполнение плана выполнения начинается с создания в памяти обслуживающего процесса объекта, который хранит в себе состояние выполняющего запроса в виде дерева, повторяющего структуру плана. Такой объект называется **порталом**, а его работа происходит по принципу конвейера.
# Источники

- https://postgrespro.ru/docs/postgrespro/10/sql-select;
- https://habr.com/ru/companies/postgrespro/articles/574702/;
- https://club.directum.ru/post/361562